<script lang="ts">
  import LuanoxIcon from "$lib/components/LuanoxIcon.svelte";
  import { createDropdownMenu, melt } from "@melt-ui/svelte";
  import { theme } from "$lib/theme";
  import {
    IconUserCircle,
    IconBook2,
    IconSquarePlus,
    IconSun,
    IconMoon,
  } from "@tabler/icons-svelte";

  const {
    states: { open: createOpen },
    elements: {
      menu: createMenu,
      item: createItem,
      trigger: createTrigger,
      arrow: createArrow,
    },
  } = createDropdownMenu();

  const {
    states: { open: accountOpen },
    elements: {
      menu: accountMenu,
      item: accountItem,
      trigger: accountTrigger,
      arrow: accountArrow,
    },
  } = createDropdownMenu();

  const createContent = [
    { label: "API Key", href: "/create/api-key" },
    { label: "Module", href: "/create/module" },
  ];

  let loggedIn = $state(true);

  function toggleTheme() {
    theme.update((currentTheme) =>
      currentTheme === "light" ? "dark" : "light"
    );
  }
</script>

<nav class="bg-base-alt border-b border-base-alt text-text">
  <div class="container px-6 py-3 flex justify-between items-center">
    <div class="font-medium text-lg">
      <a href="/" class="flex items-center"
        ><LuanoxIcon class="h-6 w-auto mr-2" />
        <span class="invisible md:visible">Luanox</span></a
      >
    </div>

    <div class="flex items-center space-x-6">
      <button onclick={toggleTheme} class="text-grey hover:text-blue">
        {#if $theme === "dark"}
          <IconMoon size={20} />
        {:else}
          <IconSun size={20} />
        {/if}
      </button>
      <a
        href="/docs"
        class="flex items-center font-medium text-grey hover:text-blue"
      >
        <IconBook2 size={20} class="mr-1" /> Docs
      </a>
      <button
        type="button"
        class="flex items-center font-medium text-grey hover:text-blue"
        use:melt={$createTrigger}
        aria-label="Open create section dropdown"
      >
        <IconSquarePlus size={20} class="mr-1" /> Create
      </button>
      {#if $createOpen}
        <div
          class="absolute right-0 top-14 w-48 bg-surface border border-dark-grey rounded-md shadow-lg z-10"
          use:melt={$createMenu}
        >
          {#each createContent as content}
            <a
              href={content.href}
              class="block px-4 py-2 text-sm text-grey hover:bg-base-alt hover:text-blue"
              use:melt={$createItem}>{content.label}</a
            >
          {/each}
          <div
            class="border-t border-l border-dark-grey"
            use:melt={$createArrow}
          ></div>
        </div>
      {/if}

      <button
        type="button"
        class="flex items-center font-medium text-grey hover:text-blue"
        use:melt={$accountTrigger}
        aria-label="Open account section dropdown"
      >
        <IconUserCircle size={20} class="mr-1" /> Account
      </button>
      {#if $accountOpen}
        <div
          class="absolute right-0 top-14 w-48 bg-surface border border-dark-grey rounded-md shadow-lg z-10"
          use:melt={$accountMenu}
        >
          {#if loggedIn}
            <a
              href="/user/profile"
              class="block px-4 py-2 text-sm text-grey hover:bg-base-alt hover:text-blue"
              use:melt={$accountItem}>Profile</a
            >
            <a
              href="/user/settings"
              class="block px-4 py-2 text-sm text-grey hover:bg-base-alt hover:text-blue"
              use:melt={$accountItem}>Settings</a
            >
            <a
              href="/user/reports"
              class="block px-4 py-2 text-sm text-grey hover:bg-base-alt hover:text-blue"
              use:melt={$accountItem}>Reports</a
            >
            <a
              href="/logout"
              class="block px-4 py-2 text-sm text-grey hover:bg-base-alt hover:text-blue"
              use:melt={$accountItem}>Logout</a
            >
          {:else}
            <div
              class="block px-4 py-2 text-sm text-grey hover:bg-base-alt hover:text-blue"
              use:melt={$accountItem}
            >
              Login
            </div>
            <div
              class="block px-4 py-2 text-sm text-grey hover:bg-base-alt hover:text-blue"
              use:melt={$accountItem}
            >
              Register
            </div>
          {/if}
          <div
            class="border-t border-l border-dark-grey"
            use:melt={$accountArrow}
          ></div>
        </div>
      {/if}
    </div>
  </div>
</nav>
